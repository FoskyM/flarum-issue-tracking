(()=>{var t={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return t.d(e,{a:e}),e},d:(s,e)=>{for(var n in e)t.o(e,n)&&!t.o(s,n)&&Object.defineProperty(s,n,{enumerable:!0,get:e[n]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s),t.d(s,{extend:()=>l});const e=flarum.core.compat["common/extenders"];var n=t.n(e);function o(t,s){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},o(t,s)}function r(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,o(t,s)}const a=flarum.core.compat["common/Model"];var i=t.n(a),c=function(t){function s(){for(var s,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(s=t.call.apply(t,[this].concat(n))||this).id=i().attribute("id"),s.slug=i().attribute("slug"),s.title=i().attribute("title"),s.description=i().attribute("description"),s.author=i().attribute("author"),s.state=i().attribute("state"),s.priority=i().attribute("priority"),s.type=i().attribute("type"),s.created_at=i().attribute("created_at",i().transformDate),s.updated_at=i().attribute("updated_at",i().transformDate),s.resolved_at=i().attribute("resolved_at",i().transformDate),s.discussion=i().hasOne("discussion"),s}return r(s,t),s}(i()),u=function(t){function s(){for(var s,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(s=t.call.apply(t,[this].concat(n))||this).id=i().attribute("id"),s.discussion_id=i().attribute("discussion_id"),s.issue_id=i().attribute("issue_id"),s}return r(s,t),s}(i());const l=[(new(n().Store)).add("issue-tracking-issues",c).add("issue-tracking-discussion-issue",u)],d=flarum.core.compat["forum/app"];var p=t.n(d);const f=flarum.core.compat["common/extend"],h=flarum.core.compat["forum/components/IndexPage"];var v=t.n(h);const g=flarum.core.compat["common/components/LinkButton"];var y=t.n(g);const b=flarum.core.compat["common/app"];var N=t.n(b);const I=flarum.core.compat["common/components/Page"];var k=t.n(I);const _=flarum.core.compat["common/helpers/listItems"];var x=t.n(_);const w=flarum.core.compat["common/components/LoadingIndicator"];var P=t.n(w);const L=flarum.core.compat["common/utils/extractText"];var T=t.n(L);const O=flarum.core.compat["common/Component"];var D=t.n(O);const j=flarum.core.compat["common/components/Button"];var A=t.n(j);const C=flarum.core.compat["common/utils/ItemList"];var S=t.n(C);const M=flarum.core.compat["common/utils/humanTime"];var B=t.n(M);const J=flarum.core.compat["common/components/Tooltip"];var z=t.n(J);const E=flarum.core.compat["common/components/Link"];var G=t.n(E);const H=flarum.core.compat["common/helpers/icon"];var R=t.n(H);const q=flarum.core.compat["common/helpers/avatar"];var F=t.n(q);const K=flarum.core.compat["common/utils/abbreviateNumber"];var Q=t.n(K),U=function(t){function s(){return t.apply(this,arguments)||this}return r(s,t),s.prototype.view=function(t){var s={},e=["IssueTracking-Label"];return this.attrs.className&&e.push(this.attrs.className),s.color=this.attrs.foreground||"#fff",this.attrs.background&&(s.backgroundColor=""+this.attrs.background,e.push("colored")),m("span",{className:e.join(" "),style:s},m("span",{className:"IssueTracking-Label-text"},t.children))},s}(D()),V=function(t){function s(){return t.apply(this,arguments)||this}return r(s,t),s.prototype.view=function(t){var s=["IssueTracking-LabelGroup"];return this.attrs.className&&s.push(this.attrs.className),m("span",{className:s.join(" ")},t.children)},s}(D()),W=function(t){function s(){return t.apply(this,arguments)||this}r(s,t);var e=s.prototype;return e.view=function(){var t=this.attrs.issue,s=t.discussion(),e=s.user();return m("div",{className:"DiscussionListItem"},m("div",{className:"DiscussionListItem-content"},m(z(),{text:N().translator.trans("core.forum.discussion_list.started_text",{user:e,ago:B()(s.createdAt())}),position:"right"},m(G(),{className:"DiscussionListItem-author",href:e?N().route.user(e):"#"},F()(e||null,{title:""}))),m(G(),{href:N().route.discussion(s,this.getJumpTo()),className:"DiscussionListItem-main"},m("h2",{className:"DiscussionListItem-title"},s.title()),m("ul",{className:"DiscussionListItem-info"},x()(this.infoItems(t).toArray()))),m("span",{className:"DiscussionListItem-count"},m("span",{"aria-hidden":"true"},Q()(t.discussion().replyCount())),m("span",{className:"visually-hidden"},N().translator.trans("core.forum.discussion_list.total_replies_a11y_label",{count:t.discussion().replyCount()})))))},e.getJumpTo=function(){var t,s=this.attrs.issue.discussion();return s.user(),Math.min(null!=(t=s.lastPostNumber())?t:0,(s.lastReadPostNumber()||0)+1)},e.infoItems=function(t){var s=new(S());return s.add("terminalPost",m("span",null,R()("far fa-clock")," ",N().translator.trans("foskym-issue-tracking.forum.last_updated",{time:B()(t.updated_at())}))),s.add("tags",m(V,null,["state","type","priority"].map((function(s){return m(U,{background:t[s]().background,foreground:t[s]().foreground},t[s]().name)})))),s},s}(D()),X=function(t){function s(){for(var s,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(s=t.call.apply(t,[this].concat(n))||this).issues=[],s.loading=!0,s}r(s,t);var e=s.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.refresh()},e.view=function(){var t=[];return this.issues.forEach((function(s){t.push(m("li",null,m(W,{issue:s})))})),m("div",{className:"IssueTracking-issues"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},x()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},x()(this.actionItems().toArray()))),this.loading?m(P(),null):m("div",{className:"IssueTracking-issuesContainer"},m("ul",{className:"IssueTracking-issuesList"},t)))},e.refresh=function(){var t=this;this.loading=!0,this.issues=[],N().store.find("issue-tracking/issues").then((function(s){t.issues=s,t.loading=!1,m.redraw()}))},e.viewItems=function(){return new(S())},e.actionItems=function(){var t=new(S());return t.add("refresh",A().component({title:N().translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:this.refresh.bind(this)})),t},s}(D()),Y=function(t){function s(){for(var s,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(s=t.call.apply(t,[this].concat(n))||this).loading=!0,s}r(s,t);var e=s.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),N().setTitle(T()(N().translator.trans("foskym-issue-tracking.forum.title"))),N().setTitleCount(0),this.load()},e.view=function(){return m("div",{className:"IndexPage"},m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,x()(v().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},this.loading?m(P(),null):m(X,null)))))},e.load=function(){this.loading=!1},s}(k());const Z=flarum.core.compat["forum/components/DiscussionHero"];var $=t.n(Z);p().initializers.add("foskym/flarum-issue-tracking",(function(){var t,s;p().routes.issues={path:"/issues",component:Y},(0,f.extend)(v().prototype,"navItems",(function(t){return t.add("issues",m(y(),{href:p().route("issues"),icon:"fab fa-github-alt"},p().translator.trans("foskym-issue-tracking.forum.title")),100),t})),s=!0,(0,f.extend)($().prototype,"oninit",(function(){p().store.find("issue-tracking/issue?id="+this.attrs.discussion.id()).then((function(e){console.log(e),t=e,s=!1,m.redraw()}))})),(0,f.extend)($().prototype,"items",(function(e){s||t&&e.add("tags",m(V,null,["state","type","priority"].map((function(s){return m(U,{background:t[s]().background,foreground:t[s]().foreground},t[s]().name)}))))}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map