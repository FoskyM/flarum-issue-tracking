(()=>{var t={n:s=>{var o=s&&s.__esModule?()=>s.default:()=>s;return t.d(o,{a:o}),o},d:(s,o)=>{for(var e in o)t.o(o,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:o[e]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s),t.d(s,{extend:()=>l});const o=flarum.core.compat["common/extenders"];var e=t.n(o);function r(t,s){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},r(t,s)}function n(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,r(t,s)}const a=flarum.core.compat["common/Model"];var i=t.n(a),c=function(t){function s(){for(var s,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return(s=t.call.apply(t,[this].concat(e))||this).id=i().attribute("id"),s.slug=i().attribute("slug"),s.title=i().attribute("title"),s.description=i().attribute("description"),s.author=i().attribute("author"),s.state=i().attribute("state"),s.priority=i().attribute("priority"),s.type=i().attribute("type"),s.created_at=i().attribute("created_at",i().transformDate),s.updated_at=i().attribute("updated_at",i().transformDate),s.resolved_at=i().attribute("resolved_at",i().transformDate),s.discussion=i().hasOne("discussion"),s.discussion_id=i().attribute("discussion_id"),s}return n(s,t),s}(i()),u=function(t){function s(){for(var s,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return(s=t.call.apply(t,[this].concat(e))||this).id=i().attribute("id"),s.discussion_id=i().attribute("discussion_id"),s.issue_id=i().attribute("issue_id"),s}return n(s,t),s}(i());const l=[(new(e().Store)).add("issue-tracking-issues",c).add("issue-tracking-discussion-issue",u)],d=flarum.core.compat["forum/app"];var f=t.n(d);const p=flarum.core.compat["common/extend"],h=flarum.core.compat["forum/components/IndexPage"];var v=t.n(h);const y=flarum.core.compat["common/components/LinkButton"];var g=t.n(y);const b=flarum.core.compat["forum/components/LogInModal"];var k=t.n(b);const _=flarum.core.compat["common/app"];var N=t.n(_);const I=flarum.core.compat["common/components/Page"];var w=t.n(I);const x=flarum.core.compat["common/helpers/listItems"];var P=t.n(x);const L=flarum.core.compat["common/components/LoadingIndicator"];var T=t.n(L);const D=flarum.core.compat["common/utils/extractText"];var C=t.n(D);const O=flarum.core.compat["common/Component"];var A=t.n(O);const j=flarum.core.compat["common/components/Button"];var S=t.n(j);const B=flarum.core.compat["common/utils/ItemList"];var M=t.n(B);const E=flarum.core.compat["common/components/Dropdown"];var J=t.n(E);const R=flarum.core.compat["common/utils/humanTime"];var z=t.n(R);const F=flarum.core.compat["common/components/Tooltip"];var G=t.n(F);const H=flarum.core.compat["common/components/Link"];var q=t.n(H);const K=flarum.core.compat["common/helpers/icon"];var Q=t.n(K);const U=flarum.core.compat["common/helpers/avatar"];var V=t.n(U);const W=flarum.core.compat["common/utils/abbreviateNumber"];var X=t.n(W),Y=function(t){function s(){return t.apply(this,arguments)||this}return n(s,t),s.prototype.view=function(t){var s={},o=["IssueTracking-Label"];return this.attrs.className&&o.push(this.attrs.className),s.color=this.attrs.foreground||"#fff",this.attrs.background&&(s.backgroundColor=""+this.attrs.background,o.push("colored")),m("span",{className:o.join(" "),style:s},m("span",{className:"IssueTracking-Label-text"},t.children))},s}(A()),Z=function(t){function s(){return t.apply(this,arguments)||this}return n(s,t),s.prototype.view=function(t){var s=["IssueTracking-LabelGroup"];return this.attrs.className&&s.push(this.attrs.className),m("span",{className:s.join(" ")},t.children)},s}(A()),$=function(t){function s(){return t.apply(this,arguments)||this}n(s,t);var o=s.prototype;return o.view=function(){var t=this.attrs.issue,s=t.discussion(),o=s.user();return m("div",{className:"DiscussionListItem"},m("div",{className:"DiscussionListItem-content"},m(G(),{text:N().translator.trans("core.forum.discussion_list.started_text",{user:o,ago:z()(s.createdAt())}),position:"right"},m(q(),{className:"DiscussionListItem-author",href:o?N().route.user(o):"#"},V()(o||null,{title:""}))),m(q(),{href:N().route.discussion(s,this.getJumpTo()),className:"DiscussionListItem-main"},m("h2",{className:"DiscussionListItem-title"},s.title()),m("ul",{className:"DiscussionListItem-info"},P()(this.infoItems(t).toArray()))),m("span",{className:"DiscussionListItem-count"},m("span",{"aria-hidden":"true"},X()(t.discussion().replyCount())),m("span",{className:"visually-hidden"},N().translator.trans("core.forum.discussion_list.total_replies_a11y_label",{count:t.discussion().replyCount()})))))},o.getJumpTo=function(){var t,s=this.attrs.issue.discussion();return s.user(),Math.min(null!=(t=s.lastPostNumber())?t:0,(s.lastReadPostNumber()||0)+1)},o.infoItems=function(t){var s=new(M());return s.add("terminalPost",m("span",null,Q()("far fa-clock")," ",N().translator.trans("foskym-issue-tracking.forum.last_updated",{time:z()(t.updated_at())}))),s.add("tags",m(Z,null,["state","type","priority"].map((function(s){return m(Y,{background:t[s]().background,foreground:t[s]().foreground},t[s]().name)})))),s},s}(A()),tt=function(t){function s(){for(var s,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return(s=t.call.apply(t,[this].concat(e))||this).issues=[],s.loading=!0,s.sorts=["newest","oldest","latest"],s.current_sort="latest",s}n(s,t);var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),this.refresh()},o.view=function(){var t=[];return this.issues.forEach((function(s){t.push(m("li",null,m($,{issue:s})))})),m("div",{className:"IssueTracking-issues"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},P()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},P()(this.actionItems().toArray()))),this.loading?m(T(),null):m("div",{className:"IssueTracking-issuesContainer"},m("ul",{className:"IssueTracking-issuesList"},t)))},o.refresh=function(){var t=this;this.loading=!0,this.issues=[],N().store.find("issue-tracking-issues",{sort:this.current_sort}).then((function(s){t.issues=s,t.loading=!1,m.redraw()}))},o.changeState=function(t){this.current_sort=t,this.refresh()},o.viewItems=function(){var t=this,s=new(M());return s.add("sort",m(J(),{buttonClassName:"Button",label:N().translator.trans("foskym-issue-tracking.forum.sort."+this.current_sort+"_button")},this.sorts.map((function(s){var o=s===t.current_sort;return m(S(),{icon:o?"fas fa-check":" ",onclick:t.changeState.bind(t,s),active:o},N().translator.trans("foskym-issue-tracking.forum.sort."+s+"_button"))})))),s},o.actionItems=function(){var t=new(M());return t.add("refresh",S().component({title:N().translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:this.refresh.bind(this)})),t},s}(A()),st=function(t){function s(){for(var s,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return(s=t.call.apply(t,[this].concat(e))||this).loading=!0,s}n(s,t);var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),N().setTitle(C()(N().translator.trans("foskym-issue-tracking.forum.title"))),N().setTitleCount(0),this.load()},o.view=function(){return m("div",{className:"IndexPage"},m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,P()(v().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},this.loading?m(T(),null):m(tt,null)))))},o.load=function(){this.loading=!1},s}(w());const ot=flarum.core.compat["common/components/ComposerBody"];var et=t.n(ot);const rt=flarum.core.compat["common/utils/Stream"];var nt=t.n(rt),at=function(t){function s(){return t.apply(this,arguments)||this}n(s,t),s.initAttrs=function(s){t.initAttrs.call(this,s),s.placeholder=s.placeholder||C()(N().translator.trans("foskym-issue-tracking.forum.composer.body_placeholder")),s.submitLabel=s.submitLabel||N().translator.trans("foskym-issue-tracking.forum.composer.submit_button"),s.confirmExit=s.confirmExit||C()(N().translator.trans("foskym-issue-tracking.forum.composer.discard_confirmation")),s.titlePlaceholder=s.titlePlaceholder||C()(N().translator.trans("foskym-issue-tracking.forum.composer.title_placeholder")),s.className="ComposerBody--issue"};var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),this.composer.fields.title=this.composer.fields.title||nt()(""),this.title=this.composer.fields.title},o.headerItems=function(){var s=t.prototype.headerItems.call(this);return s.add("issueTitle",m("h3",null,m("input",{className:"FormControl",bidi:this.title,placeholder:this.attrs.titlePlaceholder,disabled:!!this.attrs.disabled,onkeydown:this.onkeydown.bind(this)}))),s},o.onkeydown=function(t){13===t.which&&(t.preventDefault(),this.composer.editor.moveCursorTo(0)),t.redraw=!1},o.hasChanges=function(){return this.title()||this.composer.fields.content()},o.data=function(){return{title:this.title(),content:this.composer.fields.content()}},o.onsubmit=function(){var t=this;this.loading=!0;var s=this.data();N().store.createRecord("issue-tracking-issues").save(s).then((function(s){t.composer.hide(),m.route.set("/d/"+s.discussion_id())}),this.loaded.bind(this))},s}(et());const it=flarum.core.compat["forum/components/DiscussionHero"];var ct=t.n(it);f().initializers.add("foskym/flarum-issue-tracking",(function(){var t,s;f().routes.issues={path:"/issues",component:st},(0,p.extend)(v().prototype,"navItems",(function(t){return t.add("issues",m(g(),{href:f().route("issues"),icon:"fas fa-bug"},f().translator.trans("foskym-issue-tracking.forum.title")),100),t})),(0,p.extend)(v().prototype,"sidebarItems",(function(t){if("issues"===f().current.data.routeName){var s=f().forum.attribute("foskym-issue-tracking.enable_create_issue")||!f().session.user,o=t.get("newDiscussion");o.children=f().translator.trans(s?"foskym-issue-tracking.forum.new_issue":"foskym-issue-tracking.forum.cannot_create_issue"),o.attrs.disabled=!s,o.attrs.onclick=function(){return new Promise((function(t,s){return f().session.user?(f().composer.load(at,{user:f().session.user}),f().composer.show(),t(f().composer)):(f().modal.show(k()),s())})).catch((function(){}))},t.has("startDiscussion")&&t.setContent("startDiscussion",o)}})),s=!0,(0,p.extend)(ct().prototype,"oninit",(function(){f().store.find("issue-tracking/issue?id="+this.attrs.discussion.id()).then((function(o){console.log(o),t=o,s=!1,m.redraw()}))})),(0,p.extend)(ct().prototype,"items",(function(o){s||t&&o.add("tags",m(Z,null,["state","type","priority"].map((function(s){return m(Y,{background:t[s]().background,foreground:t[s]().foreground},t[s]().name)}))))}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map