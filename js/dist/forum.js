(()=>{var t={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return t.d(e,{a:e}),e},d:(s,e)=>{for(var o in e)t.o(e,o)&&!t.o(s,o)&&Object.defineProperty(s,o,{enumerable:!0,get:e[o]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s),t.d(s,{extend:()=>l});const e=flarum.core.compat["common/extenders"];var o=t.n(e);function n(t,s){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},n(t,s)}function r(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,n(t,s)}const i=flarum.core.compat["common/Model"];var a=t.n(i),c=function(t){function s(){for(var s,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(s=t.call.apply(t,[this].concat(o))||this).id=a().attribute("id"),s.slug=a().attribute("slug"),s.title=a().attribute("title"),s.description=a().attribute("description"),s.author=a().attribute("author"),s.state=a().attribute("state"),s.priority=a().attribute("priority"),s.type=a().attribute("type"),s.created_at=a().attribute("created_at",a().transformDate),s.updated_at=a().attribute("updated_at",a().transformDate),s.resolved_at=a().attribute("resolved_at",a().transformDate),s.discussion=a().hasOne("discussion"),s.discussion_id=a().attribute("discussion_id"),s}return r(s,t),s}(a()),u=function(t){function s(){for(var s,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(s=t.call.apply(t,[this].concat(o))||this).id=a().attribute("id"),s.discussion_id=a().attribute("discussion_id"),s.issue_id=a().attribute("issue_id"),s}return r(s,t),s}(a());const l=[(new(o().Store)).add("issue-tracking-issues",c).add("issue-tracking-discussion-issue",u)],d=flarum.core.compat["forum/app"];var p=t.n(d);const f=flarum.core.compat["common/extend"],h=flarum.core.compat["forum/components/IndexPage"];var v=t.n(h);const y=flarum.core.compat["common/components/LinkButton"];var g=t.n(y);const b=flarum.core.compat["forum/components/LogInModal"];var k=t.n(b);const _=flarum.core.compat["common/app"];var N=t.n(_);const I=flarum.core.compat["common/components/Page"];var w=t.n(I);const x=flarum.core.compat["common/helpers/listItems"];var P=t.n(x);const L=flarum.core.compat["common/components/LoadingIndicator"];var T=t.n(L);const D=flarum.core.compat["common/utils/extractText"];var C=t.n(D);const O=flarum.core.compat["common/Component"];var A=t.n(O);const j=flarum.core.compat["common/components/Button"];var S=t.n(j);const B=flarum.core.compat["common/utils/ItemList"];var M=t.n(B);const E=flarum.core.compat["common/utils/humanTime"];var J=t.n(E);const R=flarum.core.compat["common/components/Tooltip"];var z=t.n(R);const F=flarum.core.compat["common/components/Link"];var G=t.n(F);const H=flarum.core.compat["common/helpers/icon"];var q=t.n(H);const K=flarum.core.compat["common/helpers/avatar"];var Q=t.n(K);const U=flarum.core.compat["common/utils/abbreviateNumber"];var V=t.n(U),W=function(t){function s(){return t.apply(this,arguments)||this}return r(s,t),s.prototype.view=function(t){var s={},e=["IssueTracking-Label"];return this.attrs.className&&e.push(this.attrs.className),s.color=this.attrs.foreground||"#fff",this.attrs.background&&(s.backgroundColor=""+this.attrs.background,e.push("colored")),m("span",{className:e.join(" "),style:s},m("span",{className:"IssueTracking-Label-text"},t.children))},s}(A()),X=function(t){function s(){return t.apply(this,arguments)||this}return r(s,t),s.prototype.view=function(t){var s=["IssueTracking-LabelGroup"];return this.attrs.className&&s.push(this.attrs.className),m("span",{className:s.join(" ")},t.children)},s}(A()),Y=function(t){function s(){return t.apply(this,arguments)||this}r(s,t);var e=s.prototype;return e.view=function(){var t=this.attrs.issue,s=t.discussion(),e=s.user();return m("div",{className:"DiscussionListItem"},m("div",{className:"DiscussionListItem-content"},m(z(),{text:N().translator.trans("core.forum.discussion_list.started_text",{user:e,ago:J()(s.createdAt())}),position:"right"},m(G(),{className:"DiscussionListItem-author",href:e?N().route.user(e):"#"},Q()(e||null,{title:""}))),m(G(),{href:N().route.discussion(s,this.getJumpTo()),className:"DiscussionListItem-main"},m("h2",{className:"DiscussionListItem-title"},s.title()),m("ul",{className:"DiscussionListItem-info"},P()(this.infoItems(t).toArray()))),m("span",{className:"DiscussionListItem-count"},m("span",{"aria-hidden":"true"},V()(t.discussion().replyCount())),m("span",{className:"visually-hidden"},N().translator.trans("core.forum.discussion_list.total_replies_a11y_label",{count:t.discussion().replyCount()})))))},e.getJumpTo=function(){var t,s=this.attrs.issue.discussion();return s.user(),Math.min(null!=(t=s.lastPostNumber())?t:0,(s.lastReadPostNumber()||0)+1)},e.infoItems=function(t){var s=new(M());return s.add("terminalPost",m("span",null,q()("far fa-clock")," ",N().translator.trans("foskym-issue-tracking.forum.last_updated",{time:J()(t.updated_at())}))),s.add("tags",m(X,null,["state","type","priority"].map((function(s){return m(W,{background:t[s]().background,foreground:t[s]().foreground},t[s]().name)})))),s},s}(A()),Z=function(t){function s(){for(var s,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(s=t.call.apply(t,[this].concat(o))||this).issues=[],s.loading=!0,s}r(s,t);var e=s.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.refresh()},e.view=function(){var t=[];return this.issues.forEach((function(s){t.push(m("li",null,m(Y,{issue:s})))})),m("div",{className:"IssueTracking-issues"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},P()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},P()(this.actionItems().toArray()))),this.loading?m(T(),null):m("div",{className:"IssueTracking-issuesContainer"},m("ul",{className:"IssueTracking-issuesList"},t)))},e.refresh=function(){var t=this;this.loading=!0,this.issues=[],N().store.find("issue-tracking-issues").then((function(s){t.issues=s,t.loading=!1,m.redraw()}))},e.viewItems=function(){return new(M())},e.actionItems=function(){var t=new(M());return t.add("refresh",S().component({title:N().translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-sync",className:"Button Button--icon",onclick:this.refresh.bind(this)})),t},s}(A()),$=function(t){function s(){for(var s,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(s=t.call.apply(t,[this].concat(o))||this).loading=!0,s}r(s,t);var e=s.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),N().setTitle(C()(N().translator.trans("foskym-issue-tracking.forum.title"))),N().setTitleCount(0),this.load()},e.view=function(){return m("div",{className:"IndexPage"},m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,P()(v().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},this.loading?m(T(),null):m(Z,null)))))},e.load=function(){this.loading=!1},s}(w());const tt=flarum.core.compat["common/components/ComposerBody"];var st=t.n(tt);const et=flarum.core.compat["common/utils/Stream"];var ot=t.n(et),nt=function(t){function s(){return t.apply(this,arguments)||this}r(s,t),s.initAttrs=function(s){t.initAttrs.call(this,s),s.placeholder=s.placeholder||C()(N().translator.trans("foskym-issue-tracking.forum.composer.body_placeholder")),s.submitLabel=s.submitLabel||N().translator.trans("foskym-issue-tracking.forum.composer.submit_button"),s.confirmExit=s.confirmExit||C()(N().translator.trans("foskym-issue-tracking.forum.composer.discard_confirmation")),s.titlePlaceholder=s.titlePlaceholder||C()(N().translator.trans("foskym-issue-tracking.forum.composer.title_placeholder")),s.className="ComposerBody--issue"};var e=s.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s),this.composer.fields.title=this.composer.fields.title||ot()(""),this.title=this.composer.fields.title},e.headerItems=function(){var s=t.prototype.headerItems.call(this);return s.add("title",m("h3",null,N().translator.trans("foskym-issue-tracking.forum.composer.title")),100),s.add("issueTitle",m("h3",null,m("input",{className:"FormControl",bidi:this.title,placeholder:this.attrs.titlePlaceholder,disabled:!!this.attrs.disabled,onkeydown:this.onkeydown.bind(this)}))),s},e.onkeydown=function(t){13===t.which&&(t.preventDefault(),this.composer.editor.moveCursorTo(0)),t.redraw=!1},e.hasChanges=function(){return this.title()||this.composer.fields.content()},e.data=function(){return{title:this.title(),content:this.composer.fields.content()}},e.onsubmit=function(){var t=this;this.loading=!0;var s=this.data();N().store.createRecord("issue-tracking-issues").save(s).then((function(s){t.composer.hide(),m.route.set("/d/"+s.discussion_id())}),this.loaded.bind(this))},s}(st());const rt=flarum.core.compat["forum/components/DiscussionHero"];var it=t.n(rt);p().initializers.add("foskym/flarum-issue-tracking",(function(){var t,s;p().routes.issues={path:"/issues",component:$},(0,f.extend)(v().prototype,"navItems",(function(t){return t.add("issues",m(g(),{href:p().route("issues"),icon:"fas fa-bug"},p().translator.trans("foskym-issue-tracking.forum.title")),100),t})),(0,f.extend)(v().prototype,"sidebarItems",(function(t){if("issues"===p().current.data.routeName){var s=p().forum.attribute("foskym-issue-tracking.enable_create_issue")||!p().session.user,e=t.get("newDiscussion");e.children=p().translator.trans(s?"foskym-issue-tracking.forum.new_issue":"foskym-issue-tracking.forum.cannot_create_issue"),e.attrs.disabled=!s,e.attrs.onclick=function(){return new Promise((function(t,s){return p().session.user?(p().composer.load(nt,{user:p().session.user}),p().composer.show(),t(p().composer)):(p().modal.show(k()),s())})).catch((function(){}))},t.has("startDiscussion")&&t.setContent("startDiscussion",e)}})),s=!0,(0,f.extend)(it().prototype,"oninit",(function(){p().store.find("issue-tracking/issue?id="+this.attrs.discussion.id()).then((function(e){console.log(e),t=e,s=!1,m.redraw()}))})),(0,f.extend)(it().prototype,"items",(function(e){s||t&&e.add("tags",m(X,null,["state","type","priority"].map((function(s){return m(W,{background:t[s]().background,foreground:t[s]().foreground},t[s]().name)}))))}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map